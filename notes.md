# Chapter 2 Creating your first database and table
- sql:
    - define table structure and tables' relationship
    - query data
- Database builders prefer to organize data using separate tables for each main entity the database manages in order to reduce redundant data
- column datatype
    - `bigserial`: a special integer type that will auto-increment when a new row is added
- Text and dates (use `YYYY-DD-MM`) require quotes; numbers, including integers and decimals, donâ€™t require quotes 
- `INSERT 0 6`: insert 6 lines, you can ignore 0 here due to legacy
- code format
    - UPPER CASE keywords and data types
    - use lowercase_and_underscores for object names, such as tables and column names 
- use DISTINCT to find bad data: e, if a school name is spelled more than one way, those spelling variations will be easy to spot and correct, especially if you sort the output; use DISTINCT on multiple columns to find distinct pairs (question: `For each x in the table, what are all the y values?`)
- Using LIKE and ILIKE with WHERE
    - ILIKE 'b%', ILIKE 'ba_er'

# Chapter 4 Understanding Data Types
- Characters
    - char, varchar, text
    ```
    # export function
    CREATE TABLE char_data_types (
 	char_column char(10),
 	varchar_column varchar(10),
 	text_column text
    );

    INSERT INTO char_data_types
    VALUES
        ('abc', 'abc', 'abc'),
        ('defghi', 'defghi', 'defghi');

    COPY char_data_types TO 'C:\Users\Lenovo\Desktop\SQL\practical-sql-2\Chapter_04\typetest.txt'
    WITH (FORMAT CSV, HEADER, DELIMITER '|');

    # result 
    char_column|varchar_column|text_column
    abc       |abc|abc
    defghi    |defghi|defghi
    ```
- Numbers
    - Integers
        - smallint(2b +/- 2**15), integer(4b), bigint(8b), if insert out of range, will have `out of range` error
            - auto-increment
                - add `GENERATED ALWAYS AS IDENTITY` (cannot insert id) Vs `GENERATED BY DEFAULT AS IDENTITY` (can still insert id)
                    - some scenarios auto-increment will create gaps in the sequence of numbers in the column. e.g. If a row is deleted, the value in that row is never replaced. Or, if a row insert is aborted (due to a bug),the sequence for the column will still be incremented.
                - special ones (similar to `GENERATED BY DEFAULT AS IDENTITY`): smallserial(2b 1~2**15), serial(4b), bigserial(8b)
    - Decimals
        - decimals(precision, scale): max digits on decimal left = precision - scale,  scale = fixed decimal digits, e.g. decimal(5, 4), then it means it will be a number less than 10 with 4 decimal digits. If u miss precision and scale tgt, it will be decimal(147455, 16383)
        - real (4b, 6 decimal) vs double precision (8b, 15 decimals): not very accurate
    - 3 rules
        - first use bigint, then use decimals (set precision large enough)

- Date
    - timestamp (8b): TIMESTAMP WITH TIME ZONE(a.k.a timestamptz)
    - date (4b)
    - time (8b)
    - interval (16b)

- Json:
    - json
    - jsonb: support indexing

- Tips:
    - expressions (computed columns): `SELECT timestamp_column - interval_column AS new_date FROM date_time_types`

# Chapter 5  Importing and Exporting Data
- postgresql doesn't use header now, so we need to exclude it when importing
- text qualifier: default as double quotes. enclose a column that includes the delimiter character
    - if Postgresql finds 2 consecutive text qualifiers inside a double-quoted column, it will remove one
    ```sql
    CREATE TABLE us_countries_2010 (
        geo_name VARCHAR(90),
        state_us_abbreviation VARCHAR(2),
        ...
    ) 

    COPY us_countries_2010 (geo_name, ...)
    FROM 'C:\..'
    WITH (FORMAT CSV, HEADER, DELIMITER ',')
    WHERE state = 'Alaska';
    ```
- [primary key](https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-PRIMARY-KEYS): A primary key constraint indicates that a column, or group of columns, can be used as a **unique and not null** identifier for rows in the table. A table can have at most one primary key. or example, a GUI application that allows modifying row values probably needs to know the primary key of a table to be able to identify rows uniquely. There are also various ways in which the database system makes use of a primary key if one has been declared; for example, the primary key defines the default target column(s) for foreign keys referencing its table.
- you can delete the content of table by ```DELETE FROM supervisor_salaries```, but this wont reset the auto-increment id columns. If you want to drop the table, use ```DROP TABLEs```
- temporary table: exists only during current connection session. used to perform intermediary operations for data pipeline
```sql
CREATE TEMPORARY TABLE supervisor_salaries_temp
    (LIKE supervisor_salaries INCLUDING ALL);  
-- INCLUDING ALL means include index and indentities
COPY supervisor_salaries_temp (town, supervisor, salary)
FROM `C:\...`
WITH (FORMAT CSV, HEADER);
INSERT INTO supervisor_salaries (town, country, supervisor, salary)
    SELECT town, 'Millis', supervisor, salary 
    FROM supervisor_salaries_temp
DROP TABLE supervisor_salaries_temp
```

# Chapter 6 Basic Math and Stats with SQL
- With PostgreSQL, you can omit the table name and perform simple math and string operations using SELECT. e.g SELECT 1 + 1
 - array constructor and median
 ```sql
 SELECT percentile_count(ARRAY[0.25, 0.5, 0.75])
 WITHIN GROUP(ORDER BY pop_est_2019) AS quantiles
 FROM us_countires_2019;
 ```
- foreign key: require its value already exists in the column it references. can refer to any column with unique value
- why store in several database?
    - save space by not repeating lengthy strings
    - easier to manage, can only change one part
- filter NULL: WHERE col IS (NOT) NULL
- concatenate methods
    - UNION (unique only) Vs UNION ALL (support duplicate)
    - INTERSECT
    - EXCEPT

